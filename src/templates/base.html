<!-- base layout template -->
{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>MoneyKeeper</title>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="{% static 'css/base.css' %}" rel="stylesheet">
        <!-- Bootstrap Core CSS -->
    <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet">

        <!-- Custom CSS -->
    <link href="{% static 'dist/css/metisMenu.min.css' %}" rel="stylesheet">
    <link href="{% static 'dist/css/sb-admin-2.css' %}" rel="stylesheet">

        <!--datepicker CSS-->
    <link href="{% static 'css/bootstrap-responsive.css' %}" rel="stylesheet">

        <!-- bootstrap notification bell -->
    <link href="{% static 'dist/css/bootstrap-notifications.min.css' %}" rel="stylesheet">

        <!-- Custom Fonts -->
    <link href="{% static 'font-awesome/css/font-awesome.min.css' %}" rel="stylesheet" type="text/css">

        <!-- jQuery -->
    <script src="{% static 'js/jquery.js' %}"></script>
    <!-- <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script> -->

        <!-- Bootstrap Core JavaScript -->
    <script src="{% static 'js/bootstrap.min.js' %}"></script>

        <!-- Custom Theme JavaScript -->
    <script src="{% static 'dist/js/metisMenu.min.js' %}"></script>
    <script src="{% static 'dist/js/sb-admin-2.js' %}"></script>

    {% block local_include %}{% endblock %}

    {% block local_css %}{% endblock %} 

    {% block local_js %}{% endblock %}

    <script>
$(document).ready(function() {
    // notification handling
    var notification_len = {{ periodic_notification_count}};
    if(notification_len > 0){
        $(".fa-bell").addClass('notification-icon');
        $(".fa-bell").attr("data-count", notification_len);
    }
});

// 處理按下通知鈴鐺後的改變
$(document).on("click", "#notification-bell", function(){
    if( $(".dropdown-alerts").children().length > 0 ){
        $(".fa-bell").removeClass("notification-icon");
        $(".fa-bell").removeAttr("data-count");

        var last_li_content = $(".dropdown-alerts li:last-child a strong").text();

        if(last_li_content !== "目前沒有通知" && last_li_content !== "清除所有通知"){
            if( !$(".dropdown-alerts li:last-child").hasClass("divider") ){
                $(".dropdown-alerts").append("<li class='divider'></li>");
            }

            $(".dropdown-alerts").append("<li id='clear-alert'><a href='#'><strong>清除所有通知</strong></a></li>");
        }


    }else{
        // 如果沒通知卻按下鈴鐺要有相對應文字
        var expandedAttr = $("#notification-bell").attr("aria-expanded");

        if( expandedAttr === "true" ){
            $(".dropdown-alerts").append("<li><a href='#'><strong>目前沒有通知</strong></a></li>");
        }else{
            $(".dropdown-alerts").empty();  // 關閉視窗
        }
    }
});

$(document).on("click", "#clear-alert", function(){
    $(".dropdown-alerts").empty();
});

// 檢查是否有通知訊息需要發出
function checkNotificationBellMessage(message){
    console.log("訊息" + message);
    if(message === "正常")    // 如果檢查正常不用警告
        return;
    else if(message === null || message === "") // 如果沒訊息
        return;
    else{
        if( $(".dropdown-alerts").children().length > 0 ){

            var content = $(".dropdown-alerts strong").text();
            if(content === "目前沒有通知"){
                $(".dropdown-alerts").empty();
            }

            if( $(".fa-bell").hasClass("notification-icon") ){
               var count = parseInt( $(".fa-bell").attr("data-count") );
                count = count + 1;
                $(".fa-bell").attr("data-count", count);
            }else{
                $(".fa-bell").addClass("notification-icon");
                $(".fa-bell").attr("data-count","1");
            }

            $(".dropdown-alerts").prepend("<li><a href='#'><div><i class='fa fa-comment fa-fw'></i>" 
                                + message + "</div></a></li><li class='divider'></li>");
        }else{
            $(".fa-bell").addClass("notification-icon");
            $(".fa-bell").attr("data-count","1");

            $(".dropdown-alerts").append("<li><a href='#'><div><i class='fa fa-comment fa-fw'></i>" 
                                    + message + "</div></a></li><li class='divider'></li>");
            $(".dropdown-alerts").append("<li id='clear-alert'><a href='#'><strong>清除所有通知</strong></a></li>");
        }   
    }
}
    </script>
    


    <style type="text/css">
        body {
            background-color: rgb(229, 228, 219);
        }
        
        #page-wrapper {
            min-height: 167px;
            background-color: rgb(229, 228, 219);
        }

        #center-content {
            background-color: #fff;
            margin-top: 20px;
        }
    </style>

</head> <!-- /head -->

<body>

    <!-- whole page wrapper -->
    <div id="wrapper container">

        {% include 'navbar.html' %}
        {% block left_side_content %}{% endblock %}
        {% block main_content %}{% endblock %}

    </div><!-- /#wrapper (whole page)-->

    {% block other_content %}{% endblock %}
    
    {% block bottom_js %} {% endblock %}
</body>
</html>